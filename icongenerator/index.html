<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IconGenerator - Dynamic Icon Generator</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20width%3D'128'%20height%3D'128'%20viewBox%3D'0%200%20128%20128'%3E%3Cdefs%3E%3ClinearGradient%20id%3D'g'%20x1%3D'0%25'%20y1%3D'0%25'%20x2%3D'100%25'%20y2%3D'100%25'%3E%3Cstop%20offset%3D'0%25'%20style%3D'stop-color%3A%23180707%3Bstop-opacity%3A1'%20%2F%3E%3Cstop%20offset%3D'100%25'%20style%3D'stop-color%3A%23f2c2ff%3Bstop-opacity%3A1'%20%2F%3E%3C%2FlinearGradient%3E%3C%2Fdefs%3E%3Crect%20width%3D'128'%20height%3D'128'%20rx%3D'25.6'%20fill%3D'url(%23g)'%20%2F%3E%3Csvg%20x%3D'32'%20y%3D'32'%20width%3D'64'%20height%3D'64'%20viewBox%3D'0%200%20448%20512'%3E%3Cpath%20fill%3D'%23ffffff'%20d%3D'M50.7%2058.5L0%20160H208V32H93.7C75.5%2032%2058.9%2042.3%2050.7%2058.5zM240%20160H448L397.3%2058.5C389.1%2042.3%20372.5%2032%20354.3%2032H240V160zm208%2032H0V416c0%2035.3%2028.7%2064%2064%2064H384c35.3%200%2064-28.7%2064-64V192z'%20%2F%3E%3C%2Fsvg%3E%3C%2Fsvg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@4.1.0/fonts/remixicon.css">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/all.min.js" data-auto-replace-svg="false"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        :root {
            --bg-color: #f7fafc;
            --card-bg: #ffffff;
            --text-main: #1a202c;
            --input-bg: #edf2f7;
            --border-color: #e2e8f0;
        }
        .dark {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f1f5f9;
            --input-bg: #334155;
            --border-color: #475569;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg-color); color: var(--text-main); transition: all 0.3s; }
        .control-group { margin-bottom: 1.25rem; }
        .control-label { display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; }
        input[type="color"] { -webkit-appearance: none; border: none; width: 32px; height: 32px; padding: 0; overflow: hidden; border-radius: 50%; cursor: pointer; }
        input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        input[type="color"]::-webkit-color-swatch { border: none; }
        
        .preview-area {
            background-color: #e5e5f7;
            background-image:  repeating-linear-gradient(45deg, #d4d4ea 25%, transparent 25%, transparent 75%, #d4d4ea 75%, #d4d4ea), repeating-linear-gradient(45deg, #d4d4ea 25%, #e5e5f7 25%, #e5e5f7 75%, #d4d4ea 75%, #d4d4ea);
            background-position: 0 0, 10px 10px;
            background-size: 20px 20px;
        }
    </style>
</head>
<body class="min-h-screen pb-20">

    <div class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 py-3 px-6 mb-8">
        <div class="container mx-auto max-w-6xl flex justify-between items-center">
            <div class="flex items-center gap-3">
                <a href="../index.html" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 px-3 py-1.5 rounded-lg text-sm font-bold transition">
                    <i class="fa-solid fa-arrow-left mr-1"></i> Hub
                </a>
                <h1 class="text-xl font-bold bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent">
                    <i class="fa-solid fa-palette mr-2 text-pink-500"></i>IconGenerator
                </h1>
            </div>
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                <i class="fa-solid fa-moon dark:hidden"></i>
                <i class="fa-solid fa-sun hidden dark:block text-yellow-400"></i>
            </button>
        </div>
    </div>

    <div class="container mx-auto px-4 max-w-6xl">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <div class="lg:col-span-4 space-y-6">
                
                <div class="bg-[var(--card-bg)] p-4 rounded-xl shadow-md border border-[var(--border-color)]">
                     <button id="btn-toggle-import" class="w-full text-left font-bold text-sm flex justify-between items-center text-blue-600 hover:text-blue-700">
                        <span><i class="fa-solid fa-file-import mr-2"></i>Import / Reverse Search</span>
                        <i class="fa-solid fa-chevron-down"></i>
                     </button>
                     <div id="import-panel" class="hidden mt-3">
                        <textarea id="import-input" class="w-full text-xs font-mono p-2 bg-[var(--input-bg)] rounded border border-[var(--border-color)] h-24 mb-2" placeholder="Paste HTML, CSS, or <link rel='icon'> tag here..."></textarea>
                        <button id="btn-process-import" class="w-full bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-2 rounded">
                            Parse & Apply
                        </button>
                     </div>
                </div>

                <div class="bg-[var(--card-bg)] p-6 rounded-2xl shadow-xl border border-[var(--border-color)]">
                    <h2 class="text-xl font-bold mb-4 border-b border-[var(--border-color)] pb-2">Configuration</h2>
                    
                    <div class="control-group">
                        <label class="control-label">Quick Presets</label>
                        <select id="preset-select" class="w-full bg-[var(--input-bg)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none text-[var(--text-main)]">
                            <option value="">Select a theme...</option>
                            <option value="dashboard">Dashboard (Slate)</option>
                            <option value="logger">Logger (Green)</option>
                            <option value="analyser">Analyser (Indigo)</option>
                            <option value="medicine">MediManagr (Pink)</option>
                            <option value="vidtrackr">VidTrackr (Red)</option>
                            <option value="podtrackr">PodTrackr (Purple)</option>
                            <option value="tasktrackr">TaskTrackr (Blue)</option>
                            <option value="foodtrackr">FoodTrackr (Orange)</option>
                        </select>
                    </div>

                    <div class="control-group">
                        <label class="control-label">Icon Class</label>
                        <div class="flex gap-2 mb-2">
                            <input type="text" id="icon-class" value="fa-solid fa-rocket" class="flex-1 bg-[var(--input-bg)] rounded px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 outline-none text-[var(--text-main)]" placeholder="e.g. fa-brands fa-github">
                        </div>
                        <div class="text-[10px] text-gray-500 dark:text-gray-400 space-y-1">
                            <p><strong>Supported Libraries:</strong></p>
                            <p><i class="fa-solid fa-font-awesome w-4"></i> FontAwesome 6: <code>fa-solid fa-home</code></p>
                            <p><i class="ph-bold ph-phosphor-logo w-4"></i> Phosphor: <code>ph-bold ph-heart</code></p>
                            <p><i class="bi bi-bootstrap w-4"></i> Bootstrap: <code>bi bi-alarm</code></p>
                            <p><i class="ri-remixicon-line w-4"></i> Remix: <code>ri-home-line</code></p>
                            <p><i class='bx bx-box w-4'></i> Boxicons: <code>bx bx-user</code></p>
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">Colors</label>
                        <div class="grid grid-cols-3 gap-2">
                            <div class="text-center">
                                <input type="color" id="color-icon" value="#ffffff">
                                <div class="text-xs mt-1">Icon</div>
                            </div>
                            <div class="text-center">
                                <input type="color" id="color-bg-1" value="#4f46e5">
                                <div class="text-xs mt-1">Bg Start</div>
                            </div>
                            <div class="text-center">
                                <input type="color" id="color-bg-2" value="#9333ea">
                                <div class="text-xs mt-1">Bg End</div>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 mt-3">
                            <input type="checkbox" id="use-gradient" checked class="rounded text-blue-600 focus:ring-blue-500">
                            <label for="use-gradient" class="text-sm">Use Gradient Background</label>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="flex justify-between mb-1"><label class="control-label">Container Size</label><span id="val-size" class="text-xs text-gray-500">128px</span></div>
                        <input type="range" id="size-container" min="32" max="512" value="128" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>

                    <div class="control-group">
                        <div class="flex justify-between mb-1"><label class="control-label">Icon Size</label><span id="val-icon-size" class="text-xs text-gray-500">50%</span></div>
                        <input type="range" id="size-icon" min="10" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>

                    <div class="control-group">
                        <div class="flex justify-between mb-1"><label class="control-label">Border Radius</label><span id="val-radius" class="text-xs text-gray-500">20%</span></div>
                        <input type="range" id="radius" min="0" max="50" value="20" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>

                    <div class="control-group">
                        <label class="control-label">Border</label>
                        <div class="flex gap-2 items-center">
                            <input type="color" id="color-border" value="#ffffff" class="w-8 h-8">
                            <input type="range" id="border-width" min="0" max="20" value="0" class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span id="val-border" class="text-xs text-gray-500 w-8 text-right">0px</span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">Shadow</label>
                        <div class="flex flex-col gap-2">
                             <div class="flex items-center gap-2">
                                <label class="text-xs w-12">Opacity</label>
                                <input type="range" id="shadow-opacity" min="0" max="1" step="0.1" value="0.3" class="flex-1 h-2 bg-gray-200 rounded-lg cursor-pointer">
                             </div>
                             <div class="flex items-center gap-2">
                                <label class="text-xs w-12">Blur</label>
                                <input type="range" id="shadow-blur" min="0" max="50" value="10" class="flex-1 h-2 bg-gray-200 rounded-lg cursor-pointer">
                             </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 space-y-6">
                
                <div class="bg-[var(--card-bg)] p-8 rounded-2xl shadow-xl border border-[var(--border-color)] flex flex-col items-center justify-center min-h-[400px]">
                    <h3 class="text-gray-400 text-sm font-bold uppercase tracking-wider mb-6">Live Preview</h3>
                    
                    <div class="preview-area p-10 rounded-xl border border-dashed border-gray-300 dark:border-gray-600">
                        <div id="icon-preview" class="flex items-center justify-center transition-all duration-200">
                            <i id="preview-i" class=""></i>
                        </div>
                    </div>

                    <div class="mt-8 flex flex-wrap justify-center gap-3">
                        <button id="btn-dl-png" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-bold shadow-lg transition-transform hover:-translate-y-0.5">
                            <i class="fa-solid fa-download mr-2"></i>Download PNG
                        </button>
                        <button id="btn-copy-code" class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded-lg font-bold shadow-lg transition-transform hover:-translate-y-0.5">
                            <i class="fa-solid fa-copy mr-2"></i>Copy Code
                        </button>
                    </div>
                </div>

                <div class="bg-[var(--card-bg)] rounded-2xl shadow-xl border border-[var(--border-color)] overflow-hidden">
                    <div class="bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-[var(--border-color)] flex justify-between items-center">
                        <span class="text-xs font-mono font-bold text-gray-500">GENERATED CODE</span>
                        <div class="flex gap-2">
                            <button id="mode-html" class="mode-btn active text-xs font-bold px-3 py-1 bg-white dark:bg-gray-600 text-blue-600 dark:text-blue-300 rounded shadow-sm border border-gray-200 dark:border-gray-500 transition-colors">HTML</button>
                            <button id="mode-css-base64" class="mode-btn text-xs font-bold px-3 py-1 bg-transparent text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors">CSS (Base64)</button>
                            <button id="mode-favicon" class="mode-btn text-xs font-bold px-3 py-1 bg-transparent text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700 rounded transition-colors">Favicon Tag</button>
                        </div>
                    </div>
                    <textarea id="code-output" readonly class="w-full h-64 p-4 font-mono text-sm bg-[var(--card-bg)] text-[var(--text-main)] outline-none resize-y border-0 focus:ring-0"></textarea>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Theme Logic
        const toggleBtn = document.getElementById('theme-toggle');
        const root = document.documentElement;
        if(localStorage.getItem('theme') === 'dark') root.classList.add('dark');
        toggleBtn.addEventListener('click', () => {
            root.classList.toggle('dark');
            localStorage.setItem('theme', root.classList.contains('dark') ? 'dark' : 'light');
        });

        // Elements
        const el = {
            class: document.getElementById('icon-class'),
            colorIcon: document.getElementById('color-icon'),
            colorBg1: document.getElementById('color-bg-1'),
            colorBg2: document.getElementById('color-bg-2'),
            useGradient: document.getElementById('use-gradient'),
            sizeContainer: document.getElementById('size-container'),
            sizeIcon: document.getElementById('size-icon'),
            radius: document.getElementById('radius'),
            colorBorder: document.getElementById('color-border'),
            borderWidth: document.getElementById('border-width'),
            shadowOpacity: document.getElementById('shadow-opacity'),
            shadowBlur: document.getElementById('shadow-blur'),
            presetSelect: document.getElementById('preset-select'),
            previewBox: document.getElementById('icon-preview'),
            previewIcon: document.getElementById('preview-i'),
            codeOutput: document.getElementById('code-output'),
            valSize: document.getElementById('val-size'),
            valIconSize: document.getElementById('val-icon-size'),
            valRadius: document.getElementById('val-radius'),
            valBorder: document.getElementById('val-border'),
            // Import Elements
            btnToggleImport: document.getElementById('btn-toggle-import'),
            importPanel: document.getElementById('import-panel'),
            importInput: document.getElementById('import-input'),
            btnProcessImport: document.getElementById('btn-process-import')
        };

        // State
        let currentMode = 'html'; 

        // Presets Data (Derived from your Hub theme)
        const presets = {
            dashboard: { c1: '#0f172a', c2: '#1e293b', icon: 'fa-solid fa-gauge-high' },
            logger: { c1: '#16a34a', c2: '#15803d', icon: 'fa-solid fa-pen-to-square' },
            analyser: { c1: '#4f46e5', c2: '#4338ca', icon: 'fa-solid fa-chart-line' },
            medicine: { c1: '#db2777', c2: '#be185d', icon: 'fa-solid fa-pills' },
            vidtrackr: { c1: '#ed2224', c2: '#c01e1f', icon: 'fa-solid fa-ticket' },
            podtrackr: { c1: '#6d28d9', c2: '#5b21b6', icon: 'fa-solid fa-podcast' },
            tasktrackr: { c1: '#3b82f6', c2: '#2563eb', icon: 'fa-solid fa-check-double' },
            foodtrackr: { c1: '#EA580C', c2: '#C2410C', icon: 'fa-solid fa-utensils' }
        };

        // --- IMPORT LOGIC ---
        el.btnToggleImport.addEventListener('click', () => {
            el.importPanel.classList.toggle('hidden');
        });

        el.btnProcessImport.addEventListener('click', () => {
            const input = el.importInput.value;
            if(!input) return;
            
            // 1. Try Parse Class Name (Any supported prefix)
            const classMatch = input.match(/class=["']([^"']*(fa-|ph-|bi-|ri-|bx-)[^"']*)["']/);
            if(classMatch) {
                // Filter out utility classes if possible, or just grab the whole string
                const classes = classMatch[1].split(' ').filter(c => 
                    c.startsWith('fa-') || c.startsWith('ph-') || c.startsWith('bi-') || c.startsWith('ri-') || c.startsWith('bx-') || c === 'bi' || c === 'bx'
                ).join(' ');
                if(classes) el.class.value = classes;
            }

            // 2. Try Parse Colors (Hex only for simplicity)
            const hexColors = input.match(/#[0-9a-fA-F]{6}/g);
            if(hexColors) {
                if(hexColors.length === 1) {
                    // Assume background color
                    el.colorBg1.value = hexColors[0];
                    el.useGradient.checked = false;
                } else if(hexColors.length >= 2) {
                    // Check if it's a gradient string
                    if(input.includes('gradient')) {
                        el.colorBg1.value = hexColors[0];
                        el.colorBg2.value = hexColors[1];
                        el.useGradient.checked = true;
                    } else {
                         // Assume first is bg, second is icon? Hard to guess order. 
                         // Let's guess: if one is white/light and one is dark.
                         el.colorBg1.value = hexColors[0];
                         el.colorIcon.value = hexColors[1];
                         el.useGradient.checked = false;
                    }
                }
            }

            // 3. Try Parse Dimensions
            const widthMatch = input.match(/width:\s*(\d+)px/);
            if(widthMatch) el.sizeContainer.value = widthMatch[1];

            // 4. Try Parse Border Radius
            const radMatch = input.match(/border-radius:\s*(\d+)%/);
            if(radMatch) el.radius.value = radMatch[1];

            // 5. Special Case: Favicon Data URI Parsing
            if(input.includes('data:image/svg+xml')) {
                try {
                    const uri = input.match(/href="([^"]+)"/);
                    const dataStr = uri ? uri[1] : input; // Handle full tag or just URI
                    
                    const decoded = decodeURIComponent(dataStr.split(',')[1]);
                    const parser = new DOMParser();
                    const svgDoc = parser.parseFromString(decoded, "image/svg+xml");
                    
                    // Get Rect Fill (Background)
                    const rect = svgDoc.querySelector('rect');
                    if(rect) {
                        const fill = rect.getAttribute('fill');
                        if(fill.includes('url(#g)')) {
                            el.useGradient.checked = true;
                            const stops = svgDoc.querySelectorAll('stop');
                            if(stops.length >= 2) {
                                el.colorBg1.value = stops[0].style.stopColor;
                                el.colorBg2.value = stops[1].style.stopColor;
                            }
                        } else {
                            el.useGradient.checked = false;
                            el.colorBg1.value = fill;
                        }
                        
                        // Try to approximate radius percentage based on width
                        const w = rect.getAttribute('width');
                        const rx = rect.getAttribute('rx');
                        if(w && rx) {
                            el.radius.value = Math.round((rx / w) * 100);
                        }
                    }

                    // Get Path Fill (Icon Color)
                    const path = svgDoc.querySelector('path');
                    if(path) {
                        el.colorIcon.value = path.getAttribute('fill');
                    }
                    
                    alert("Imported Styles! Note: Original icon class name cannot be recovered from raw SVG data. Please select your icon manually.");
                } catch(e) {
                    console.error("SVG Parse Error", e);
                }
            }
            
            generate();
            el.btnToggleImport.click(); // Close panel
        });

        // Preset Listener
        el.presetSelect.addEventListener('change', (e) => {
            const p = presets[e.target.value];
            if(p) {
                el.colorBg1.value = p.c1;
                el.colorBg2.value = p.c2;
                el.class.value = p.icon;
                el.useGradient.checked = true;
                generate();
            }
        });

        function getSVGString() {
            const size = parseInt(el.sizeContainer.value);
            const iconClass = el.class.value;
            const cBg1 = el.colorBg1.value;
            const cBg2 = el.colorBg2.value;
            const isGrad = el.useGradient.checked;
            const cIcon = el.colorIcon.value;
            const radius = (parseInt(el.radius.value) / 100) * size;
            const iconRatio = parseInt(el.sizeIcon.value) / 100;
            const iconSize = size * iconRatio;
            const iconOffset = (size - iconSize) / 2;

            // Get Path
            let pathData = null;
            let viewBox = '0 0 512 512';

            // FontAwesome Path Extraction
            if (window.FontAwesome) {
                const parts = iconClass.split(' ');
                let prefix = 'fas'; 
                let iconName = '';
                parts.forEach(p => {
                    if (p === 'fa-brands' || p === 'fab') prefix = 'fab';
                    if (p === 'fa-regular' || p === 'far') prefix = 'far';
                    if (p.startsWith('fa-') && !['fa-solid','fa-brands','fa-regular','fa-fw'].includes(p)) {
                        iconName = p.replace('fa-', '');
                    }
                });
                const icon = window.FontAwesome.findIconDefinition({ prefix, iconName });
                if(icon) {
                    pathData = icon.icon[4];
                    viewBox = `0 0 ${icon.icon[0]} ${icon.icon[1]}`;
                }
            }

            if(!pathData) return null; // Can't generate SVG if path missing

            let svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${size}' height='${size}' viewBox='0 0 ${size} ${size}'>`;
            svg += `<defs>`;
            if (isGrad) {
                svg += `<linearGradient id='g' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:${cBg1};stop-opacity:1' /><stop offset='100%' style='stop-color:${cBg2};stop-opacity:1' /></linearGradient>`;
            }
            svg += `</defs>`;
            
            const fill = isGrad ? `url(#g)` : cBg1;
            svg += `<rect width='${size}' height='${size}' rx='${radius}' fill='${fill}' />`;
            svg += `<svg x='${iconOffset}' y='${iconOffset}' width='${iconSize}' height='${iconSize}' viewBox='${viewBox}'>`;
            svg += `<path fill='${cIcon}' d='${pathData}' />`;
            svg += `</svg></svg>`;
            return svg;
        }

        function generate() {
            const size = el.sizeContainer.value;
            const iSize = el.sizeIcon.value;
            const rad = el.radius.value;
            const bWidth = el.borderWidth.value;
            const bColor = el.colorBorder.value;
            const cIcon = el.colorIcon.value;
            const cBg1 = el.colorBg1.value;
            const cBg2 = el.colorBg2.value;
            const isGrad = el.useGradient.checked;
            const sOp = el.shadowOpacity.value;
            const sBlur = el.shadowBlur.value;
            const iconClass = el.class.value;

            // UI Update
            el.valSize.textContent = `${size}px`;
            el.valIconSize.textContent = `${iSize}%`;
            el.valRadius.textContent = `${rad}%`;
            el.valBorder.textContent = `${bWidth}px`;

            // Preview Styles
            const bgStyle = isGrad ? `linear-gradient(135deg, ${cBg1}, ${cBg2})` : cBg1;
            const shadowStyle = sOp > 0 ? `0 4px ${sBlur}px rgba(0,0,0,${sOp})` : 'none';

            el.previewIcon.className = iconClass;
            Object.assign(el.previewBox.style, {
                width: `${size}px`,
                height: `${size}px`,
                background: bgStyle,
                borderRadius: `${rad}%`,
                border: `${bWidth}px solid ${bColor}`,
                boxShadow: shadowStyle,
                color: cIcon,
                fontSize: `${(size * (iSize/100))}px`
            });

            // GENERATE OUTPUT BASED ON MODE
            let output = '';

            if (currentMode === 'html') {
                output = `
<div style="
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: ${size}px;
    height: ${size}px;
    background: ${bgStyle};
    border-radius: ${rad}%;
    border: ${bWidth}px solid ${bColor};
    box-shadow: ${shadowStyle};
    color: ${cIcon};
    font-size: ${(size * (iSize/100)).toFixed(0)}px;
">
    <i class="${iconClass}"></i>
</div>`.trim();
            } 
            else if (currentMode === 'css-base64' || currentMode === 'favicon') {
                const svgStr = getSVGString();
                if(svgStr) {
                    const dataUri = `data:image/svg+xml,${encodeURIComponent(svgStr)}`;
                    if(currentMode === 'favicon') {
                         output = `<link rel="icon" href="${dataUri}">`;
                    } else {
                         output = `background-image: url('${dataUri}');\nwidth: ${size}px;\nheight: ${size}px;\nbackground-size: contain;\nbackground-repeat: no-repeat;`;
                    }
                } else {
                    output = "SVG generation currently only works for valid FontAwesome icons. Try picking a preset or ensuring the icon class is correct.";
                }
            }

            el.codeOutput.value = output;
        }

        // Mode Switching
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.mode-btn').forEach(b => {
                    b.classList.remove('active', 'bg-white', 'dark:bg-gray-600', 'text-blue-600', 'dark:text-blue-300', 'shadow-sm', 'border');
                    b.classList.add('bg-transparent', 'text-gray-500', 'dark:text-gray-400');
                });
                e.target.classList.remove('bg-transparent', 'text-gray-500', 'dark:text-gray-400');
                e.target.classList.add('active', 'bg-white', 'dark:bg-gray-600', 'text-blue-600', 'dark:text-blue-300', 'shadow-sm', 'border', 'border-gray-200', 'dark:border-gray-500');
                
                if(e.target.id === 'mode-html') currentMode = 'html';
                if(e.target.id === 'mode-css-base64') currentMode = 'css-base64';
                if(e.target.id === 'mode-favicon') currentMode = 'favicon';
                generate();
            });
        });

        // Listeners
        Object.values(el).forEach(element => {
            if(element && (element.tagName === 'INPUT' || element.tagName === 'SELECT')) {
                element.addEventListener('input', generate);
            }
        });

        document.getElementById('btn-dl-png').addEventListener('click', () => {
            html2canvas(el.previewBox, { backgroundColor: null, scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `icon-${Date.now()}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        });

        document.getElementById('btn-copy-code').addEventListener('click', () => {
            el.codeOutput.select();
            navigator.clipboard.writeText(el.codeOutput.value);
            const btn = document.getElementById('btn-copy-code');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-check mr-2"></i>Copied!';
            setTimeout(() => btn.innerHTML = originalText, 2000);
        });

        // Init
        generate();

    </script>
</body>
</html>