<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timestamp Converter - Lifeblogging Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" href="./favicons/clock.svg" type="image/svg+xml">
    
    <style>
        :root {
            --bg-color: #f7fafc;
            --card-bg-color: white;
            --text-color-primary: #1a202c;
            --text-color-secondary: #4a5568;
            --input-bg-color: #e2e8f0;
            --border-color: #e2e8f0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --clock-border-color: #333;
            --clock-hand-color: #333;
            --clock-second-hand-color: #e53e3e;
            --favorite-star-color: #f59e0b;
        }
        .dark {
            --bg-color: #1a202c;
            --card-bg-color: #2d3748;
            --text-color-primary: #edf2f7;
            --text-color-secondary: #a0aec0;
            --input-bg-color: #4a5568;
            --border-color: #4a5568;
            --shadow-color: rgba(0, 0, 0, 0.4);
            --clock-border-color: #edf2f7;
            --clock-hand-color: #edf2f7;
            --clock-second-hand-color: #f87171;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .theme-switcher {
            background-color: var(--card-bg-color);
            border: 1px solid var(--text-color-secondary);
            border-radius: 9999px;
            padding: 0.5rem;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease, opacity 0.3s ease;
        }
        .theme-switcher:hover:not(:disabled) { opacity: 0.8; }
        .theme-switcher:disabled { cursor: not-allowed; opacity: 0.5; }
        .theme-icon { width: 1.5rem; height: 1.5rem; color: var(--text-color-primary); }
        .dark .sun-icon { display: block; }
        .dark .moon-icon { display: none; }
        .sun-icon { display: none; }
        .moon-icon { display: block; }
        .output-box {
            background-color: var(--input-bg-color);
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-family: monospace;
            word-break: break-all;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .output-box:hover {
            background-color: #d1d5db;
        }
        .dark .output-box:hover {
            background-color: #6b7280;
        }
        .clock-container {
            width: 150px;
            height: 150px;
            border: 5px solid var(--clock-border-color);
            border-radius: 50%;
            position: relative;
            margin: 0 auto 1rem;
        }
        .clock-hand {
            width: 50%;
            height: 4px;
            background: var(--clock-hand-color);
            position: absolute;
            top: 50%;
            transform-origin: 100%;
            transform: rotate(90deg);
            transition: transform 0.05s;
        }
        .hour-hand {
            width: 35%;
            left: 15%;
        }
        .minute-hand {
            width: 45%;
            left: 5%;
        }
        .second-hand {
            height: 2px;
            background: var(--clock-second-hand-color);
        }
        .favorite-star {
            cursor: pointer;
            color: var(--text-color-secondary);
            transition: color 0.2s;
        }
        .favorite-star.favorited {
            color: var(--favorite-star-color);
        }
        .scheduler-timeline {
            position: relative;
            height: 20px;
            background-color: var(--input-bg-color);
            border-radius: 10px;
        }
        .business-hours {
            position: absolute;
            height: 100%;
            background-color: #34d399;
            opacity: 0.6;
            border-radius: 10px;
        }
    </style>
</head>
<body class="min-h-screen pt-12 pb-12 px-4 sm:px-6 lg:px-8">
    <div class="top-right-controls" style="position: absolute; top: 1.5rem; right: 1.5rem;">
        <button id="theme-toggle" class="theme-switcher" title="Toggle dark mode">
            <svg class="theme-icon sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
            <svg class="theme-icon moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
        </button>
    </div>

    <div class="max-w-4xl mx-auto">
        <div class="bg-[var(--card-bg-color)] shadow-lg rounded-xl p-8 mb-8">
            <h2 class="text-2xl font-bold text-center text-[var(--text-color-primary)] mb-4">Current Local Time</h2>
            <div class="clock-container">
                <div class="clock-hand hour-hand"></div>
                <div class="clock-hand minute-hand"></div>
                <div class="clock-hand second-hand"></div>
            </div>
            <div id="digital-clock" class="text-4xl font-mono text-center"></div>
        </div>

        <div class="bg-[var(--card-bg-color)] shadow-lg rounded-xl p-8">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-4xl font-bold text-[var(--text-color-primary)]">Timestamp Converter</h1>
                <a href="/" class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-300 ease-in-out shadow-lg">Back to Hub</a>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <h2 class="text-2xl font-bold text-[var(--text-color-primary)] mb-4">Input</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="input-date" class="block text-sm font-medium text-[var(--text-color-secondary)]">Date</label>
                            <input type="date" id="input-date" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-[var(--input-bg-color)] text-[var(--text-color-primary)] p-2">
                        </div>
                        <div>
                            <label for="input-time" class="block text-sm font-medium text-[var(--text-color-secondary)]">Time</label>
                            <input type="time" id="input-time" step="1" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-[var(--input-bg-color)] text-[var(--text-color-primary)] p-2">
                        </div>
                        <div>
                            <label for="country-search" class="block text-sm font-medium text-[var(--text-color-secondary)]">Country</label>
                            <input type="text" id="country-search" list="country-list" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-[var(--input-bg-color)] text-[var(--text-color-primary)] p-2" placeholder="Search for a country...">
                            <datalist id="country-list"></datalist>
                        </div>
                        <div>
                            <label for="input-timezone" class="block text-sm font-medium text-[var(--text-color-secondary)]">Input Timezone</label>
                            <div class="flex items-center gap-2">
                                <select id="input-timezone" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-[var(--input-bg-color)] text-[var(--text-color-primary)] p-2"></select>
                                <i id="input-tz-fav" class="fas fa-star favorite-star mt-1"></i>
                            </div>
                        </div>
                        <button id="use-current-time-btn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition duration-300 ease-in-out shadow-lg">Use Current Time</button>
                    </div>
                </div>

                <div>
                    <h2 class="text-2xl font-bold text-[var(--text-color-primary)] mb-4">Output</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="output-timezone" class="block text-sm font-medium text-[var(--text-color-secondary)]">Output Timezone</label>
                                <div class="flex items-center gap-2">
                                    <select id="output-timezone" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-[var(--input-bg-color)] text-[var(--text-color-primary)] p-2"></select>
                                    <i id="output-tz-fav" class="fas fa-star favorite-star mt-1"></i>
                                </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-[var(--text-color-primary)] mt-6 mb-2">Converted Timestamps</h3>
                            <div class="space-y-3">
                                <div class="output-wrapper">
                                    <label class="block text-sm font-medium text-[var(--text-color-secondary)]">Relative to Now</label>
                                    <div id="output-relative" class="output-box"></div>
                                </div>
                                <div class="output-wrapper">
                                    <label class="block text-sm font-medium text-[var(--text-color-secondary)]">UTC Time</label>
                                    <div id="output-utc" class="output-box"></div>
                                </div>
                                <div class="output-wrapper">
                                    <label class="block text-sm font-medium text-[var(--text-color-secondary)]">ISO 8601 (Local)</label>
                                    <div id="output-iso" class="output-box"></div>
                                </div>
                                <div class="output-wrapper">
                                    <label class="block text-sm font-medium text-[var(--text-color-secondary)]">Full (with DST)</label>
                                    <div id="output-full" class="output-box flex justify-between items-center">
                                        <span id="output-full-text"></span>
                                        <span id="dst-indicator" class="text-lg"></span>
                                    </div>
                                </div>
                                <div class="output-wrapper">
                                    <label class="block text-sm font-medium text-[var(--text-color-secondary)]">Unix Timestamp (seconds)</label>
                                    <div id="output-unix" class="output-box"></div>
                                </div>
                            </div>
                            <div class="flex gap-2 mt-4">
                                <button id="share-btn" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition">Share</button>
                                <button id="calendar-btn" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition">Add to Calendar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 border-t border-[var(--border-color)] pt-6">
                <h2 class="text-2xl font-bold text-[var(--text-color-primary)] mb-4">Time Until</h2>
                <div id="time-until-output" class="text-3xl font-bold text-center p-4 rounded-lg bg-[var(--input-bg-color)]">
                    Select a future date and time to see the countdown.
                </div>
            </div>

            <div class="mt-8 border-t border-[var(--border-color)] pt-6">
                <h2 class="text-2xl font-bold text-[var(--text-color-primary)] mb-4">Sheets/Excel Date Converter</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
                    <div>
                        <label for="sheets-date-input" class="block text-sm font-medium text-[var(--text-color-secondary)]">Sheets/Excel Serial Number</label>
                        <input type="number" id="sheets-date-input" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md bg-[var(--input-bg-color)] text-[var(--text-color-primary)] p-2" placeholder="e.g., 45956">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-color-secondary)]">Converted Date</label>
                        <div id="sheets-date-output" class="output-box mt-1"></div>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 border-t border-[var(--border-color)] pt-6">
                <h2 class="text-2xl font-bold text-[var(--text-color-primary)] mb-4">Meeting Scheduler</h2>
                <div class="space-y-4">
                    <div id="scheduler-timezones"></div>
                    <button id="add-scheduler-tz-btn" class="w-full bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 transition">Add Timezone</button>
                </div>
            </div>

        </div>
    </div>
    <div id="copy-toast" class="fixed bottom-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transition-opacity duration-300">
        Copied to clipboard!
    </div>
    <script type="module">
        import { format, zonedTimeToUtc, utcToZonedTime } from 'https://cdn.jsdelivr.net/npm/date-fns-tz@2.0.0/+esm';

        // --- Theme Logic (Standalone) ---
        const themeToggle = document.getElementById('theme-toggle');
        const body = document.body;

        const applyTheme = (theme) => {
            if (theme === 'dark') body.classList.add('dark');
            else body.classList.remove('dark');
        };

        const toggleTheme = () => {
            const currentTheme = body.classList.contains('dark') ? 'dark' : 'light';
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            applyTheme(newTheme);
            try {
                localStorage.setItem('theme', newTheme);
            } catch (error) {
                console.error("Error saving theme to localStorage:", error);
            }
        };
        
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            applyTheme(savedTheme);
        }

        themeToggle.addEventListener('click', toggleTheme);

        // --- Timestamp Converter Logic ---
        const countryToTimezone = {
            "Afghanistan": ["Asia/Kabul"],
            "Albania": ["Europe/Tirane"],
            "Algeria": ["Africa/Algiers"],
            "Andorra": ["Europe/Andorra"],
            "Angola": ["Africa/Luanda"],
            "Argentina": ["America/Argentina/Buenos_Aires", "America/Argentina/Cordoba", "America/Argentina/Jujuy", "America/Argentina/Tucuman", "America/Argentina/Catamarca", "America/Argentina/La_Rioja", "America/Argentina/San_Juan", "America/Argentina/Mendoza", "America/Argentina/Rio_Gallegos", "America/Argentina/Ushuaia"],
            "Armenia": ["Asia/Yerevan"],
            "Australia": ["Australia/Lord_Howe", "Australia/Hobart", "Australia/Currie", "Australia/Melbourne", "Australia/Sydney", "Australia/Broken_Hill", "Australia/Brisbane", "Australia/Lindeman", "Australia/Adelaide", "Australia/Darwin", "Australia/Perth", "Australia/Eucla"],
            "Austria": ["Europe/Vienna"],
            "Azerbaijan": ["Asia/Baku"],
            "Bahamas": ["America/Nassau"],
            "Bahrain": ["Asia/Bahrain"],
            "Bangladesh": ["Asia/Dhaka"],
            "Barbados": ["America/Barbados"],
            "Belarus": ["Europe/Minsk"],
            "Belgium": ["Europe/Brussels"],
            "Belize": ["America/Belize"],
            "Bolivia": ["America/La_Paz"],
            "Brazil": ["America/Noronha", "America/Belem", "America/Fortaleza", "America/Recife", "America/Araguaina", "America/Maceio", "America/Bahia", "America/Sao_Paulo", "America/Campo_Grande", "America/Cuiaba", "America/Santarem", "America/Porto_Velho", "America/Boa_Vista", "America/Manaus", "America/Eirunepe", "America/Rio_Branco"],
            "Canada": ["America/St_Johns", "America/Halifax", "America/Glace_Bay", "America/Moncton", "America/Goose_Bay", "America/Blanc-Sablon", "America/Toronto", "America/Nipigon", "America/Thunder_Bay", "America/Iqaluit", "America/Pangnirtung", "America/Atikokan", "America/Winnipeg", "America/Rainy_River", "America/Resolute", "America/Rankin_Inlet", "America/Regina", "America/Swift_Current", "America/Edmonton", "America/Cambridge_Bay", "America/Yellowknife", "America/Inuvik", "America/Creston", "America/Dawson_Creek", "America/Fort_Nelson", "America/Vancouver", "America/Whitehorse", "America/Dawson"],
            "Chile": ["America/Santiago", "America/Punta_Arenas", "Pacific/Easter"],
            "China": ["Asia/Shanghai", "Asia/Urumqi"],
            "Colombia": ["America/Bogota"],
            "Costa Rica": ["America/Costa_Rica"],
            "Croatia": ["Europe/Zagreb"],
            "Cuba": ["America/Havana"],
            "Cyprus": ["Asia/Nicosia", "Asia/Famagusta"],
            "Czech Republic": ["Europe/Prague"],
            "Denmark": ["Europe/Copenhagen"],
            "Ecuador": ["America/Guayaquil", "Pacific/Galapagos"],
            "Egypt": ["Africa/Cairo"],
            "Estonia": ["Europe/Tallinn"],
            "Fiji": ["Pacific/Fiji"],
            "Finland": ["Europe/Helsinki"],
            "France": ["Europe/Paris"],
            "Georgia": ["Asia/Tbilisi"],
            "Germany": ["Europe/Berlin", "Europe/Busingen"],
            "Greece": ["Europe/Athens"],
            "Greenland": ["America/Godthab", "America/Danmarkshavn", "America/Scoresbysund", "America/Thule"],
            "Guatemala": ["America/Guatemala"],
            "Honduras": ["America/Tegucigalpa"],
            "Hong Kong": ["Asia/Hong_Kong"],
            "Hungary": ["Europe/Budapest"],
            "Iceland": ["Atlantic/Reykjavik"],
            "India": ["Asia/Kolkata"],
            "Indonesia": ["Asia/Jakarta", "Asia/Pontianak", "Asia/Makassar", "Asia/Jayapura"],
            "Iran": ["Asia/Tehran"],
            "Ireland": ["Europe/Dublin"],
            "Israel": ["Asia/Jerusalem"],
            "Italy": ["Europe/Rome"],
            "Jamaica": ["America/Jamaica"],
            "Japan": ["Asia/Tokyo"],
            "Kazakhstan": ["Asia/Almaty", "Asia/Qyzylorda", "Asia/Qostanay", "Asia/Aqtobe", "Asia/Aqtau", "Asia/Atyrau", "Asia/Oral"],
            "Kenya": ["Africa/Nairobi"],
            "Kyrgyzstan": ["Asia/Bishkek"],
            "Latvia": ["Europe/Riga"],
            "Lebanon": ["Asia/Beirut"],
            "Libya": ["Africa/Tripoli"],
            "Lithuania": ["Europe/Vilnius"],
            "Luxembourg": ["Europe/Luxembourg"],
            "Malaysia": ["Asia/Kuala_Lumpur", "Asia/Kuching"],
            "Maldives": ["Indian/Maldives"],
            "Malta": ["Europe/Malta"],
            "Mexico": ["America/Mexico_City", "America/Cancun", "America/Merida", "America/Monterrey", "America/Matamoros", "America/Mazatlan", "America/Chihuahua", "America/Ojinaga", "America/Hermosillo", "America/Tijuana", "America/Bahia_Banderas"],
            "Monaco": ["Europe/Monaco"],
            "Mongolia": ["Asia/Ulaanbaatar", "Asia/Hovd", "Asia/Choibalsan"],
            "Morocco": ["Africa/Casablanca"],
            "Myanmar": ["Asia/Yangon"],
            "Nepal": ["Asia/Kathmandu"],
            "Netherlands": ["Europe/Amsterdam"],
            "New Zealand": ["Pacific/Auckland", "Pacific/Chatham"],
            "Nicaragua": ["America/Managua"],
            "Nigeria": ["Africa/Lagos"],
            "North Korea": ["Asia/Pyongyang"],
            "Norway": ["Europe/Oslo"],
            "Pakistan": ["Asia/Karachi"],
            "Panama": ["America/Panama"],
            "Papua New Guinea": ["Pacific/Port_Moresby", "Pacific/Bougainville"],
            "Paraguay": ["America/Asuncion"],
            "Peru": ["America/Lima"],
            "Philippines": ["Asia/Manila"],
            "Poland": ["Europe/Warsaw"],
            "Portugal": ["Europe/Lisbon", "Atlantic/Madeira", "Atlantic/Azores"],
            "Qatar": ["Asia/Qatar"],
            "Romania": ["Europe/Bucharest"],
            "Russia": ["Europe/Kaliningrad", "Europe/Moscow", "Europe/Kirov", "Europe/Volgograd", "Europe/Saratov", "Europe/Ulyanovsk", "Europe/Samara", "Europe/Astrakhan", "Asia/Yekaterinburg", "Asia/Omsk", "Asia/Novosibirsk", "Asia/Barnaul", "Asia/Tomsk", "Asia/Novokuznetsk", "Asia/Krasnoyarsk", "Asia/Irkutsk", "Asia/Chita", "Asia/Yakutsk", "Asia/Khandyga", "Asia/Vladivostok", "Asia/Ust-Nera", "Asia/Magadan", "Asia/Sakhalin", "Asia/Srednekolymsk", "Asia/Kamchatka", "Asia/Anadyr"],
            "Saudi Arabia": ["Asia/Riyadh"],
            "Serbia": ["Europe/Belgrade"],
            "Singapore": ["Asia/Singapore"],
            "Slovakia": ["Europe/Bratislava"],
            "Slovenia": ["Europe/Ljubljana"],
            "South Africa": ["Africa/Johannesburg"],
            "South Korea": ["Asia/Seoul"],
            "Spain": ["Europe/Madrid", "Africa/Ceuta", "Atlantic/Canary"],
            "Sweden": ["Europe/Stockholm"],
            "Switzerland": ["Europe/Zurich"],
            "Syria": ["Asia/Damascus"],
            "Taiwan": ["Asia/Taipei"],
            "Thailand": ["Asia/Bangkok"],
            "Turkey": ["Europe/Istanbul"],
            "Turkmenistan": ["Asia/Ashgabat"],
            "Ukraine": ["Europe/Simferopol", "Europe/Kiev", "Europe/Uzhgorod", "Europe/Zaporozhye"],
            "United Arab Emirates": ["Asia/Dubai"],
            "United Kingdom": ["Europe/London"],
            "United States": ["America/New_York", "America/Detroit", "America/Kentucky/Louisville", "America/Kentucky/Monticello", "America/Indiana/Indianapolis", "America/Indiana/Vincennes", "America/Indiana/Winamac", "America/Indiana/Marengo", "America/Indiana/Petersburg", "America/Indiana/Vevay", "America/Chicago", "America/Indiana/Tell_City", "America/Indiana/Knox", "America/Menominee", "America/North_Dakota/Center", "America/North_Dakota/New_Salem", "America/North_Dakota/Beulah", "America/Denver", "America/Boise", "America/Phoenix", "America/Los_Angeles", "America/Anchorage", "America/Juneau", "America/Sitka", "America/Metlakatla", "America/Yakutat", "America/Nome", "America/Adak", "Pacific/Honolulu"],
            "Uruguay": ["America/Montevideo"],
            "Uzbekistan": ["Asia/Samarkand", "Asia/Tashkent"],
            "Venezuela": ["America/Caracas"],
            "Vietnam": ["Asia/Ho_Chi_Minh"],
        };
        
        const inputDateEl = document.getElementById('input-date');
        const inputTimeEl = document.getElementById('input-time');
        const countrySearchEl = document.getElementById('country-search');
        const countryListEl = document.getElementById('country-list');
        const inputTimezoneEl = document.getElementById('input-timezone');
        const outputTimezoneEl = document.getElementById('output-timezone');
        const useCurrentTimeBtn = document.getElementById('use-current-time-btn');
        const timeUntilOutputEl = document.getElementById('time-until-output');
        const shareBtn = document.getElementById('share-btn');
        const calendarBtn = document.getElementById('calendar-btn');

        const outputUtcEl = document.getElementById('output-utc');
        const outputIsoEl = document.getElementById('output-iso');
        const outputRelativeEl = document.getElementById('output-relative');
        const outputFullTextEl = document.getElementById('output-full-text');
        const dstIndicatorEl = document.getElementById('dst-indicator');
        const outputUnixEl = document.getElementById('output-unix');

        const sheetsDateInputEl = document.getElementById('sheets-date-input');
        const sheetsDateOutputEl = document.getElementById('sheets-date-output');
        
        const hourHand = document.querySelector('.hour-hand');
        const minuteHand = document.querySelector('.minute-hand');
        const secondHand = document.querySelector('.second-hand');
        const digitalClock = document.getElementById('digital-clock');

        const schedulerTimezonesEl = document.getElementById('scheduler-timezones');
        const addSchedulerTzBtn = document.getElementById('add-scheduler-tz-btn');

        let favoriteTimezones = JSON.parse(localStorage.getItem('favoriteTimezones')) || [];

        function populateCountries() {
            const countries = Object.keys(countryToTimezone).sort();
            countryListEl.innerHTML = '';
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                countryListEl.appendChild(option);
            });
        }
        
        function populateTimezones(selectElement, timezones) {
            selectElement.innerHTML = ''; // Clear existing options
            
            // Add favorites first
            const favGroup = document.createElement('optgroup');
            favGroup.label = 'Favorites';
            favoriteTimezones.forEach(tz => {
                favGroup.appendChild(new Option(tz, tz));
            });
            if (favoriteTimezones.length > 0) {
                selectElement.add(favGroup);
            }

            // Add all other timezones
            const allGroup = document.createElement('optgroup');
            allGroup.label = 'All Timezones';
            timezones.forEach(tz => {
                if (!favoriteTimezones.includes(tz)) {
                    allGroup.appendChild(new Option(tz, tz));
                }
            });
            selectElement.add(allGroup);
        }
        
        function updateTimezoneOptions() {
            const selectedCountry = countrySearchEl.value;
            if (countryToTimezone[selectedCountry]) {
                const timezones = countryToTimezone[selectedCountry];
                populateTimezones(inputTimezoneEl, timezones);
                populateTimezones(outputTimezoneEl, timezones);
            }
            convertAndDisplay();
        }

        function convertAndDisplay() {
            const date = inputDateEl.value;
            const time = inputTimeEl.value;
            const inputTz = inputTimezoneEl.value;
            const outputTz = outputTimezoneEl.value;
            
            if (!date || !time || !inputTz || !outputTz) return;
            
            const localDate = new Date(`${date}T${time}`);
            if (isNaN(localDate)) return;
            
            const utcDate = zonedTimeToUtc(localDate, inputTz);
            const zonedDate = utcToZonedTime(utcDate, outputTz);

            if (outputUtcEl) outputUtcEl.textContent = utcDate.toISOString();
            if (outputIsoEl) outputIsoEl.textContent = zonedDate.toISOString();
            if (outputRelativeEl) outputRelativeEl.textContent = getRelativeTimeString(zonedDate);
            
            const formattedFull = format(zonedDate, 'PPPP pppp', { timeZone: outputTz });
            const tzAbbreviation = new Intl.DateTimeFormat('en', { timeZone: outputTz, timeZoneName: 'short' }).formatToParts(zonedDate).find(part => part.type === 'timeZoneName').value;
            
            if (outputFullTextEl) {
                outputFullTextEl.textContent = `${formattedFull.replace(tzAbbreviation, '')} (${tzAbbreviation})`;
            }
            
            const isDST = isDaylightSavingTime(zonedDate, outputTz);
            if(dstIndicatorEl) {
                dstIndicatorEl.textContent = isDST ? '☀️' : '🌙';
                dstIndicatorEl.title = isDST ? 'Daylight Saving Time is in effect' : 'Standard Time is in effect';
            }
            
            if(outputUnixEl) outputUnixEl.textContent = Math.floor(zonedDate.getTime() / 1000);

            updateTimeUntil();
            updateScheduler();
        }

        function convertSheetsDate() {
            const serial = parseInt(sheetsDateInputEl.value, 10);
            if (isNaN(serial) || serial <= 0) {
                sheetsDateOutputEl.textContent = '';
                return;
            }
            // Excel's epoch starts on 1899-12-30. Day 1 is Jan 1, 1900.
            // JavaScript's epoch is 1970-01-01.
            // The difference is 25569 days (including the incorrect 1900 leap day).
            const excelEpoch = new Date(1899, 11, 30);
            const date = new Date(excelEpoch.getTime() + serial * 86400000);
            sheetsDateOutputEl.textContent = date.toLocaleDateString('en-GB', {
                year: 'numeric', month: 'long', day: 'numeric'
            });
        }
        
        function getRelativeTimeString(date) {
            const now = new Date();
            const diffSeconds = (date.getTime() - now.getTime()) / 1000;
            const rtf = new Intl.RelativeTimeFormat('en', { numeric: 'auto' });

            if (Math.abs(diffSeconds) < 60) {
                return rtf.format(Math.round(diffSeconds), 'second');
            }
            const diffMinutes = diffSeconds / 60;
            if (Math.abs(diffMinutes) < 60) {
                return rtf.format(Math.round(diffMinutes), 'minute');
            }
            const diffHours = diffMinutes / 60;
            if (Math.abs(diffHours) < 24) {
                return rtf.format(Math.round(diffHours), 'hour');
            }
            const diffDays = diffHours / 24;
            return rtf.format(Math.round(diffDays), 'day');
        }
        
        function isDaylightSavingTime(date, timeZone) {
            const year = date.getFullYear();
            const jan = new Date(year, 0, 1);
            const jul = new Date(year, 6, 1);
            const stdOffset = Math.max(jan.getTimezoneOffset(), jul.getTimezoneOffset());
            return date.getTimezoneOffset() < stdOffset;
        }

        function updateTimeUntil() {
            const date = inputDateEl.value;
            const time = inputTimeEl.value;
            const inputTz = inputTimezoneEl.value;

            if (!date || !time || !inputTz) return;

            const targetDate = zonedTimeToUtc(new Date(`${date}T${time}`), inputTz);
            const now = new Date();

            const diff = targetDate.getTime() - now.getTime();

            if (diff < 0) {
                timeUntilOutputEl.textContent = 'This time has already passed.';
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            timeUntilOutputEl.textContent = `${days}d ${hours}h ${minutes}m ${seconds}s`;
        }

        function setCurrentTime() {
            const now = new Date();
            inputDateEl.value = format(now, 'yyyy-MM-dd');
            inputTimeEl.value = format(now, 'HH:mm:ss');
            convertAndDisplay();
        }
        
        function setClocks() {
            const now = new Date();
            const seconds = now.getSeconds();
            const minutes = now.getMinutes();
            const hours = now.getHours();
            
            const secondsDegrees = ((seconds / 60) * 360) + 90;
            const minutesDegrees = ((minutes / 60) * 360) + ((seconds/60)*6) + 90;
            const hoursDegrees = ((hours / 12) * 360) + ((minutes/60)*30) + 90;

            secondHand.style.transform = `rotate(${secondsDegrees}deg)`;
            minuteHand.style.transform = `rotate(${minutesDegrees}deg)`;
            hourHand.style.transform = `rotate(${hoursDegrees}deg)`;
            
            digitalClock.textContent = now.toLocaleTimeString();
        }
        
        function addSchedulerTimezone(tz) {
            const id = `scheduler-tz-${Date.now()}`;
            const div = document.createElement('div');
            div.id = id;
            div.className = 'flex items-center gap-4';
            div.innerHTML = `
                <div class="flex-1">
                    <select class="scheduler-tz-select w-full p-2 rounded-md bg-[var(--input-bg-color)]"></select>
                </div>
                <div class="scheduler-timeline flex-1">
                    <div class="business-hours"></div>
                </div>
                <button class="remove-scheduler-tz-btn text-red-500 hover:text-red-700" data-target="${id}">&times;</button>
            `;
            const select = div.querySelector('.scheduler-tz-select');
            populateTimezones(select, [...new Set(Object.values(countryToTimezone).flat())].sort());
            if (tz) select.value = tz;
            
            schedulerTimezonesEl.appendChild(div);
            select.addEventListener('change', updateScheduler);
            div.querySelector('.remove-scheduler-tz-btn').addEventListener('click', (e) => {
                document.getElementById(e.target.dataset.target).remove();
                updateScheduler();
            });
            updateScheduler();
        }
        
        function updateScheduler() {
            const date = inputDateEl.value;
            if (!date) return;

            document.querySelectorAll('.scheduler-timeline').forEach((timeline, index) => {
                const select = schedulerTimezonesEl.querySelectorAll('.scheduler-tz-select')[index];
                const tz = select.value;
                const businessHoursEl = timeline.querySelector('.business-hours');
                
                const startBusiness = zonedTimeToUtc(new Date(`${date}T09:00:00`), tz);
                const endBusiness = zonedTimeToUtc(new Date(`${date}T17:00:00`), tz);

                const startOffset = (startBusiness.getUTCHours() * 60 + startBusiness.getUTCMinutes()) / (24 * 60) * 100;
                const endOffset = (endBusiness.getUTCHours() * 60 + endBusiness.getUTCMinutes()) / (24 * 60) * 100;
                
                businessHoursEl.style.left = `${startOffset}%`;
                businessHoursEl.style.width = `${endOffset - startOffset}%`;
            });
        }
        
        function handleFavorite(tz, starEl) {
            if (favoriteTimezones.includes(tz)) {
                favoriteTimezones = favoriteTimezones.filter(f => f !== tz);
                starEl.classList.remove('favorited');
            } else {
                favoriteTimezones.push(tz);
                starEl.classList.add('favorited');
            }
            localStorage.setItem('favoriteTimezones', JSON.stringify(favoriteTimezones));
            const allTimezones = [...new Set(Object.values(countryToTimezone).flat())].sort();
            populateTimezones(inputTimezoneEl, allTimezones);
            populateTimezones(outputTimezoneEl, allTimezones);
        }

        [inputDateEl, inputTimeEl, inputTimezoneEl, outputTimezoneEl].forEach(el => {
            el.addEventListener('change', convertAndDisplay);
        });

        sheetsDateInputEl.addEventListener('input', convertSheetsDate);
        useCurrentTimeBtn.addEventListener('click', setCurrentTime);
        countrySearchEl.addEventListener('input', updateTimezoneOptions);
        addSchedulerTzBtn.addEventListener('click', () => addSchedulerTimezone(Intl.DateTimeFormat().resolvedOptions().timeZone));

        document.querySelectorAll('.output-box').forEach(box => {
            box.addEventListener('click', () => {
                navigator.clipboard.writeText(box.textContent);
                const toast = document.getElementById('copy-toast');
                toast.classList.remove('opacity-0');
                setTimeout(() => {
                    toast.classList.add('opacity-0');
                }, 2000);
            });
        });
        
        shareBtn.addEventListener('click', () => {
            const params = new URLSearchParams({
                date: inputDateEl.value,
                time: inputTimeEl.value,
                inputTz: inputTimezoneEl.value,
                outputTz: outputTimezoneEl.value
            });
            navigator.clipboard.writeText(`${window.location.href.split('?')[0]}?${params.toString()}`);
            const toast = document.getElementById('copy-toast');
            toast.textContent = 'Share link copied!';
            toast.classList.remove('opacity-0');
                setTimeout(() => {
                    toast.classList.add('opacity-0');
                    toast.textContent = 'Copied to clipboard!'; // Reset for next time
                }, 2000);
        });

        calendarBtn.addEventListener('click', () => {
            const date = inputDateEl.value;
            const time = inputTimeEl.value;
            if (!date || !time) return;

            const startDate = new Date(`${date}T${time}`);
            const endDate = new Date(startDate.getTime() + 60 * 60 * 1000); // 1 hour duration
            
            const toICSDate = (d) => d.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';

            const icsContent = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Lifeblogging Hub//Timestamp Converter//EN
BEGIN:VEVENT
UID:${Date.now()}@lifeblogging.app
DTSTAMP:${toICSDate(new Date())}
DTSTART:${toICSDate(startDate)}
DTEND:${toICSDate(endDate)}
SUMMARY:Converted Event
DESCRIPTION:Event created from Timestamp Converter
END:VEVENT
END:VCALENDAR`;

            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'event.ics';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });
        
        document.getElementById('input-tz-fav').addEventListener('click', (e) => handleFavorite(inputTimezoneEl.value, e.target));
        document.getElementById('output-tz-fav').addEventListener('click', (e) => handleFavorite(outputTimezoneEl.value, e.target));

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if(urlParams.has('date')) {
                inputDateEl.value = urlParams.get('date');
                inputTimeEl.value = urlParams.get('time');
                inputTimezoneEl.value = urlParams.get('inputTz');
                outputTimezoneEl.value = urlParams.get('outputTz');
            }

            populateCountries();
            const allTimezones = [...new Set(Object.values(countryToTimezone).flat())].sort();
            populateTimezones(inputTimezoneEl, allTimezones);
            populateTimezones(outputTimezoneEl, allTimezones);
            
            const localTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            if (localTimezone) {
                inputTimezoneEl.value = localTimezone;
                outputTimezoneEl.value = localTimezone;
            }
            
            setCurrentTime();
            setClocks();
            setInterval(setClocks, 1000);
            setInterval(updateTimeUntil, 1000);

            addSchedulerTimezone('America/New_York');
            addSchedulerTimezone('Europe/London');
        });

    </script>
</body>
</html>